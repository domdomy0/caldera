- id: 92cb926e-1e63-4ec3-9b47-certify-esc1
  name: Discover Vulnerable ADCS Templates (ESC1) with Certify
  description: Use Certify.exe to find certificate templates vulnerable to ESC1 misconfigurations
  tactic: discovery
  technique:
    attack_id: T1649
    name: "Steal or Forge Authentication Certificates"
  platforms:
    windows:
      psh:
        command: |
          .\Certify.exe find /vulnerable
        parsers:
          plugins.adversary_emulation.app.parsers.regex_parser:
            - source: 'esc1.template'
              edge_label: 'is_esc1_vulnerable'
              custom_parser_vals:
                # Match if block contains all 3 key indicators, extract the template name
                regex: '(?s)Template Name\s+:\s+([^\r\n]+).*?ENROLLEE_SUPPLIES_SUBJECT.*?(Client Authentication).*?(Enrollment Rights\s+:\s+NT AUTHORITY\\Authenticated Users|Enrollment Rights\s+:\s+#{domain.name}\\\\Domain Users)'